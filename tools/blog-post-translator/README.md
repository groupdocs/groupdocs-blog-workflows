# Blog Post Translator

Automated translation tool for blog posts using LLM (Large Language Model). This tool reads the translation status report generated by `missing-translations-scanner` and translates missing blog posts to target languages.

## Features

- **Automated Translation**: Translates blog posts using LLM API
- **Front-matter Translation**: Translates title, SEO title, description, summary, and cover fields
- **Content Translation**: Translates main blog post content while preserving markdown formatting
- **URL Localization**: Automatically updates URLs with language prefixes
- **Selective Translation**: Filter by language, specific post, or limit number of posts
- **Dry-run Mode**: Preview what would be translated without actually translating
- **Progress Tracking**: Shows progress and summary statistics

## Prerequisites

- Python 3.7 or higher
- Environment variables configured:
  - `PROFESSIONALIZE_API_KEY`: API key for LLM service
  - `PROFESSIONALIZE_API_URL`: (Optional) API URL, defaults to `https://llm.professionalize.com/v1`
  - `MODEL_NAME`: (Optional) Model name, defaults to `gpt-oss`

## Installation

1. Install dependencies:
```bash
pip install -r requirements.txt
```

2. Set environment variables:
```bash
# Windows PowerShell
$env:PROFESSIONALIZE_API_KEY = "your-api-key-here"

# Linux/Mac
export PROFESSIONALIZE_API_KEY="your-api-key-here"
```

## Usage

### Basic Usage

Translate all missing translations from the report:
```bash
python translate_posts.py translation_status.json
```

### Translate to Specific Language

Translate only to Arabic:
```bash
python translate_posts.py translation_status.json --lang ar
```

### Translate Specific Post

Translate only a specific blog post:
```bash
python translate_posts.py translation_status.json --post "content/Groupdocs.Blog/comparison/2025-09-01-groupdocs-comparison-for-net-25-8"
```

### Limit Number of Posts

Translate only the first 5 posts:
```bash
python translate_posts.py translation_status.json --limit 5
```

### Dry Run

Preview what would be translated without actually translating:
```bash
python translate_posts.py translation_status.json --dry-run
```

### Verbose Output

Enable detailed output:
```bash
python translate_posts.py translation_status.json --verbose
```

### Combined Options

Translate first 3 posts to Arabic with verbose output:
```bash
python translate_posts.py translation_status.json --lang ar --limit 3 --verbose
```

## Command-Line Options

| Option | Description |
|--------|-------------|
| `report` | Path to translation status JSON report (required) |
| `--lang CODE` | Translate only to specific language code (e.g., `ar`, `de`, `fr`) |
| `--post PATH` | Translate only specific post path |
| `--limit N` | Limit number of posts to translate |
| `--verbose` | Enable verbose output |
| `--dry-run` | Show what would be translated without actually translating |

## How It Works

1. **Load Report**: Reads the `translation_status.json` report generated by `missing-translations-scanner`
2. **Filter Posts**: Applies filters based on command-line options (language, post path, limit)
3. **Read English Post**: Reads the English `index.md` file for each post
4. **Parse Front-matter**: Extracts YAML front-matter and content body
5. **Translate Front-matter**: Translates translatable fields:
   - `title`
   - `seoTitle`
   - `description`
   - `summary`
   - `cover.alt` (if present)
   - `cover.caption` (if present)
   - Updates `url` with language prefix
6. **Translate Content**: Translates the main content body while preserving markdown formatting
7. **Save Translation**: Saves translated post as `index.{lang}.md` in the post directory

## Translation Details

### Translated Fields

- **Front-matter fields**: `title`, `seoTitle`, `description`, `summary`
- **Cover fields**: `alt`, `caption` (if present)
- **Content body**: Main markdown content
- **URL**: Automatically prefixed with language code (e.g., `/ar/...`)

### Preserved Elements

- Markdown formatting (headers, lists, code blocks, etc.)
- URLs and links
- Code snippets
- Special characters
- Front-matter structure

### Supported Languages

The tool supports all languages defined in the blog configuration:
- Arabic (ar)
- Czech (cs)
- German (de)
- Spanish (es)
- Persian/Farsi (fa)
- French (fr)
- Hebrew (he)
- Indonesian (id)
- Italian (it)
- Japanese (ja)
- Korean (ko)
- Dutch (nl)
- Polish (pl)
- Portuguese (pt)
- Russian (ru)
- Thai (th)
- Turkish (tr)
- Ukrainian (uk)
- Vietnamese (vi)
- Chinese Simplified (zh)
- Chinese Traditional (zh-hant)

## Output

### Console Output

The tool provides progress information:
- Current post being processed
- Missing languages for each post
- Translation progress per language
- Summary statistics

Example output:
```
Found 20 posts with missing translations

[1/20] Processing: content\Groupdocs.Blog\comparison\2025-09-01-groupdocs-comparison-for-net-25-8
Missing languages: ar, cs, de, es, fa, fr, he, id, it, ja, ko, nl, pl, pt, ru, th, tr, uk, vi, zh, zh-hant
  [1/21] Translating to ar... ✓
  [2/21] Translating to cs... ✓
  ...

================================================================================
TRANSLATION SUMMARY
================================================================================
Total translations completed: 420
Total translations failed: 0
================================================================================
```

### File Output

Translated posts are saved as `index.{lang}.md` files in their respective post directories:
```
content/Groupdocs.Blog/comparison/2025-09-01-groupdocs-comparison-for-net-25-8/
  ├── index.md          (English - original)
  ├── index.ar.md       (Arabic - translated)
  ├── index.cs.md       (Czech - translated)
  ├── index.de.md       (German - translated)
  └── ...
```

## Error Handling

- **Missing Report File**: Exits with error message
- **Invalid JSON**: Exits with parsing error
- **Missing Post File**: Skips post with warning
- **Translation Failure**: Marks as failed, continues with next translation
- **Save Failure**: Reports error, continues processing

## Integration with missing-translations-scanner

This tool is designed to work with the `missing-translations-scanner` tool:

1. **Generate Report**: First, run the scanner to identify missing translations:
   ```bash
   python tools/missing-translations-scanner/scan_missing_translations.py \
     --content content \
     --config config.yml \
     --output translation_status.json
   ```

2. **Translate Posts**: Then, use this tool to translate missing posts:
   ```bash
   python tools/ai-blog-translator/translate_posts.py translation_status.json
   ```

3. **Verify**: Re-run the scanner to verify translations were created:
   ```bash
   python tools/missing-translations-scanner/scan_missing_translations.py \
     --content content \
     --config config.yml \
     --output translation_status.json
   ```

## Notes

- **API Costs**: Translation uses LLM API calls, which may incur costs. Use `--limit` and `--lang` to control scope.
- **Translation Quality**: Review translations for accuracy, especially technical terms and code examples.
- **Rate Limiting**: The tool processes translations sequentially. If you encounter rate limits, reduce `--limit` or add delays.
- **Large Posts**: Very long posts may exceed token limits. Consider splitting or truncating if needed.
- **Preserved Formatting**: The tool preserves markdown formatting, but always review the output for formatting issues.

## Troubleshooting

### "Missing environment variable: PROFESSIONALIZE_API_KEY"
Set the environment variable before running:
```bash
export PROFESSIONALIZE_API_KEY="your-key"
```

### "Error translating text"
- Check API key is valid
- Verify API URL is accessible
- Check network connection
- Review API rate limits

### "Warning: Could not parse front-matter"
- Ensure post file has valid YAML front-matter
- Check for special characters that might break YAML parsing

### Translation quality issues
- Review and edit translations manually if needed
- Consider adjusting the translation prompt in the code
- Use `--verbose` to see detailed translation process

## License

This tool is part of the GroupDocs blog repository.

